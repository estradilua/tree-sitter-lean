======
syntax
======

syntax "=>" term:2 : term

---

(module
  (command
    (cmd_syntax
      (syntax_p
        (atom
          (str_lit)))
      (syntax_p
        (cat
          (ident)
          (precedence
            (num_lit))))
      (ident))))

====================
initialize ambiguous
====================

initialize foo : Int ← pure ()
                       return 2

---

(module
  (command
    (cmd_initialize
      (ident)
      (type_spec
        (term
          (term_ident
            (ident))))
      (left_arrow)
      (do_seq
        (do_seq_indent
          (do_seq_item
            (do_elem
              (do_expr
                (term
                  (term_ident
                    (ident))
                  (term_tuple)))))
          (do_seq_item
            (do_elem
              (do_expr
                (term
                  (term_ident
                    (ident))
                  (term_num
                    (num_lit)))))))))))

=================
initialize do_seq
=================

initialize let foo : Int ← pure ()
           return 2

---

(module
  (command
    (cmd_initialize
      (do_seq
        (do_seq_indent
          (do_seq_item
            (do_elem
              (do_let_arrow
                (do_id_decl
                  (ident)
                  (type_spec
                    (term
                      (term_ident
                        (ident))))
                  (left_arrow)
                  (do_elem
                    (do_expr
                      (term
                        (term_ident
                          (ident))
                        (term_tuple))))))))
          (do_seq_item
            (do_elem
              (do_expr
                (term
                  (term_ident
                    (ident))
                  (term_num
                    (num_lit)))))))))))

===================================
nested do_seq blocks ending at once
===================================

initialize
  do
    let a := 1

---

(module
  (command
    (cmd_initialize
      (do_seq
        (do_seq_indent
          (do_seq_item
            (do_elem
              (do_expr
                (term
                  (term_do
                    (do_seq
                      (do_seq_indent
                        (do_seq_item
                          (do_elem
                            (do_let
                              (let_decl
                                (let_id_decl
                                  (let_id_lhs
                                    (ident))
                                  (defeq)
                                  (term
                                    (term_num
                                      (num_lit))))))))))))))))))))

================
inductive vacant
================


inductive Vacant : Type where

---

(module
  (command
    (cmd_declaration
      (inductive
        (decl_ident
          (ident))
        (type_spec
          (term
            (term_type)))))))

==================
inductive either''
==================

inductive Either'' : Type u → Type v → Type (max u v + 1) where
  | left : {α : Type u} → {β : Type v} → α → Either'' α β
  | right : β → Either'' α β

---

(module
  (command
    (cmd_declaration
      (inductive
        (decl_ident
          (ident))
        (type_spec
          (term
            (term_arrow
              (term_type
                (level_ident
                  (ident)))
              (right_arrow)
              (term
                (term_arrow
                  (term_type
                    (level_ident
                      (ident)))
                  (right_arrow)
                  (term
                    (term_type
                      (level_paren
                        (level_max)
                        (level_ident
                          (ident))
                        (level_ident
                          (ident))
                        (level_add)
                        (level_num
                          (num_lit))))))))))
        (ctor
          (ident)
          (type_spec
            (term
              (term_dep_arrow
                (bracketed_binder
                  (implicit_binder
                    (ident)
                    (type_spec
                      (term
                        (term_type
                          (level_ident
                            (ident)))))))
                (right_arrow)
                (term
                  (term_dep_arrow
                    (bracketed_binder
                      (implicit_binder
                        (ident)
                        (type_spec
                          (term
                            (term_type
                              (level_ident
                                (ident)))))))
                    (right_arrow)
                    (term
                      (term_arrow
                        (term_ident
                          (ident))
                        (right_arrow)
                        (term
                          (term_ident
                            (ident))
                          (term_ident
                            (ident))
                          (term_ident
                            (ident)))))))))))
        (ctor
          (ident)
          (type_spec
            (term
              (term_arrow
                (term_ident
                  (ident))
                (right_arrow)
                (term
                  (term_ident
                    (ident))
                  (term_ident
                    (ident))
                  (term_ident
                    (ident)))))))))))

==========================
definition with match_alts
==========================

def AtLeastOne.head : AtLeastOne α → α
  | ⟨x, _⟩ => x
  | .mk x _ => x

---

(module
  (command
    (cmd_declaration
      (definition
        (decl_ident
          (ident))
        (type_spec
          (term
            (term_ident
              (ident))
            (term_arrow
              (term_ident
                (ident))
              (right_arrow)
              (term
                (term_ident
                  (ident))))))
        (decl_val
          (decl_val_eqns
            (match_alts
              (match_alt
                (term
                  (term_anonymous_ctor
                    (term
                      (term_ident
                        (ident)))
                    (term
                      (term_hole))))
                (darrow)
                (term
                  (term_ident
                    (ident))))
              (match_alt
                (term
                  (term_other)
                  (term_ident
                    (ident))
                  (term_ident
                    (ident))
                  (term_hole))
                (darrow)
                (term
                  (term_ident
                    (ident)))))))))))

==============
non-identifier
:error
==============

import Lean.Parser. Command

---



================
non-identifier 2
:error
================

import Lean .Parser.Command

---



=======================
"by" inside parentheses
=======================

example : True := by
  exact (by have := trivial
            trivial)
  done

---

(module
  (command
    (cmd_declaration
      (example
        (type_spec
          (term
            (term_ident
              (ident))))
        (decl_val
          (decl_val_simple
            (defeq)
            (term
              (term_by
                (tactic_seq
                  (tactic_seq_indented
                    (tactic_p
                      (tactic_other
                        (ident)
                        (term
                          (term_paren
                            (term
                              (term_by
                                (tactic_seq
                                  (tactic_seq_indented
                                    (tactic_p
                                      (tactic_other
                                        (ident)
                                        (term
                                          (term_other)
                                          (term_other)
                                          (term_ident
                                            (ident)))))
                                    (tactic_p
                                      (tactic_other
                                        (ident)))))))))))
                    (tactic_p
                      (tactic_other
                        (ident)))))))))))))

=============================
silly parenthesis indentation
=============================

example : True := by
  exact (by
  have := trivial
  trivial)
  done

---

(module
  (command
    (cmd_declaration
      (example
        (type_spec
          (term
            (term_ident
              (ident))))
        (decl_val
          (decl_val_simple
            (defeq)
            (term
              (term_by
                (tactic_seq
                  (tactic_seq_indented
                    (tactic_p
                      (tactic_other
                        (ident)
                        (term
                          (term_paren
                            (term
                              (term_by
                                (tactic_seq
                                  (tactic_seq_indented
                                    (tactic_p
                                      (tactic_other
                                        (ident)
                                        (term
                                          (term_other)
                                          (term_other)
                                          (term_ident
                                            (ident)))))
                                    (tactic_p
                                      (tactic_other
                                        (ident)))))))))))
                    (tactic_p
                      (tactic_other
                        (ident)))))))))))))

==========
cat.lean 1
==========

instance : Functor.Full typeToCat.{u} where
  map_surjective F := ⟨Discrete.as ∘ F.obj ∘ Discrete.mk, by
    apply Functor.ext
    · intro x y f
      dsimp
      apply ULift.ext
      aesop_cat
    · rintro ⟨x⟩
      apply Discrete.ext
      rfl⟩

end CategoryTheory

---

(module
  (command
    (cmd_declaration
      (instance
        (type_spec
          (term
            (term_ident
              (ident))
            (term_ident
              (ident)
              (level_ident
                (ident)))))
        (decl_val
          (where_struct_inst
            (struct_inst_field
              (ident)
              (binder
                (ident))
              (defeq)
              (term
                (term_anonymous_ctor
                  (term
                    (term_ident
                      (ident))
                    (term_other)
                    (term_ident
                      (ident))
                    (term_other)
                    (term_ident
                      (ident)))
                  (term
                    (term_by
                      (tactic_seq
                        (tactic_seq_indented
                          (tactic_p
                            (tactic_other
                              (ident)
                              (term
                                (term_ident
                                  (ident)))))
                          (tactic_p
                            (tactic_cdot
                              (cdot)
                              (tactic_seq
                                (tactic_seq_indented
                                  (tactic_p
                                    (tactic_intro
                                      (term
                                        (term_ident
                                          (ident))
                                        (term_ident
                                          (ident))
                                        (term_ident
                                          (ident)))))
                                  (tactic_p
                                    (tactic_other
                                      (ident)))
                                  (tactic_p
                                    (tactic_other
                                      (ident)
                                      (term
                                        (term_ident
                                          (ident)))))
                                  (tactic_p
                                    (tactic_other
                                      (ident)))))))
                          (tactic_p
                            (tactic_cdot
                              (cdot)
                              (tactic_seq
                                (tactic_seq_indented
                                  (tactic_p
                                    (tactic_other
                                      (ident)
                                      (term
                                        (term_anonymous_ctor
                                          (term
                                            (term_ident
                                              (ident)))))))
                                  (tactic_p
                                    (tactic_other
                                      (ident)
                                      (term
                                        (term_ident
                                          (ident)))))
                                  (tactic_p
                                    (tactic_other
                                      (ident)))))))))))))))))))
  (command
    (cmd_end
      (ident))))

===========================================
anonymous ctor with by's separated by comma
===========================================

inductive Foo where
  | mkFoo : Nat → Nat → Foo

example : Foo := by
  exact ⟨by exact 1, by exact 2⟩

---

(module
  (command
    (cmd_declaration
      (inductive
        (decl_ident
          (ident))
        (ctor
          (ident)
          (type_spec
            (term
              (term_arrow
                (term_ident
                  (ident))
                (right_arrow)
                (term
                  (term_arrow
                    (term_ident
                      (ident))
                    (right_arrow)
                    (term
                      (term_ident
                        (ident))))))))))))
  (command
    (cmd_declaration
      (example
        (type_spec
          (term
            (term_ident
              (ident))))
        (decl_val
          (decl_val_simple
            (defeq)
            (term
              (term_by
                (tactic_seq
                  (tactic_seq_indented
                    (tactic_p
                      (tactic_other
                        (ident)
                        (term
                          (term_anonymous_ctor
                            (term
                              (term_by
                                (tactic_seq
                                  (tactic_seq_indented
                                    (tactic_p
                                      (tactic_other
                                        (ident)
                                        (term
                                          (term_num
                                            (num_lit)))))))))
                            (term
                              (term_by
                                (tactic_seq
                                  (tactic_seq_indented
                                    (tactic_p
                                      (tactic_other
                                        (ident)
                                        (term
                                          (term_num
                                            (num_lit)))))))))))))))))))))))

================
linearmap.defs 1
================

instance (priority := 100) instAddMonoidHomClass [FunLike F M M₃] [SemilinearMapClass F σ M M₃] :
    AddMonoidHomClass F M M₃ :=
  { SemilinearMapClass.toAddHomClass with
    map_zero := fun f ↦
      show f 0 = 0 by
        rw [← zero_smul R (0 : M), map_smulₛₗ]
        simp : Type }

---



===================
weird struct binder
===================

structure Bar where
  (bar baz (a : Nat) b : Nat := a + b)

---

(module
  (command
    (cmd_declaration
      (structure
        (decl_ident
          (ident))
        (struct_fields
          (struct_explicit_binder
            (ident)
            (ident)
            (bracketed_binder
              (explicit_binder
                (ident)
                (type_spec
                  (term
                    (term_ident
                      (ident))))))
            (ident)
            (type_spec
              (term
                (term_ident
                  (ident))))
            (defeq)
            (term
              (term_ident
                (ident))
              (term_other)
              (term_ident
                (ident)))))))))

========================
struct_inst empty fields
========================

structure Bar where

def Foo (a b : Bar) : Bar := {a, b with}

---



=======================
cursed type ascriptions
=======================

#check (by obtain : True : True)

---

(module
  (command
    (cmd_hash
      (term
        (term_paren
          (term
            (term_by
              (tactic_seq
                (tactic_seq_indented
                  (tactic_p
                    (tactic_other
                      (ident)
                      (term
                        (term_other)
                        (term_ident
                          (ident))
                        (term_other)
                        (term_ident
                          (ident))))))))))))))
